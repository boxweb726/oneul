<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>오늘뭐볼까? - 마이페이지</title>
  <link rel="icon" href="./images/logo_favicon.png" type="image/x-icon">
  <meta property="og:title" content="오늘뭐볼까?"> 
  <meta property="og:url" content="https://oneul-9b3e4.web.app/">
  <meta property="og:type" content="website">
  <meta property="og:image" content="/images/ogimg.png"> 
  <meta property="og:description" content="영화리뷰 플랫폼 오늘뭐볼까?">
  <link href="css/mypage.css" rel="stylesheet">
  <!-- 필수 호출 script -->
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    const firebaseConfig = {
    apiKey: "AIzaSyBPwBvkUab2QHIgqTPODBIC8gWWowDohjM",
    authDomain: "oneul-9b3e4.firebaseapp.com",
    databaseURL: "https://oneul-9b3e4-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "oneul-9b3e4",
    storageBucket: "oneul-9b3e4.appspot.com",
    messagingSenderId: "993417131341",
    appId: "1:993417131341:web:ce271d5bffa75a7d42f304"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
  </script>
  <!-- 필수 호출 script -->

</head>
<body>
  <header class="header-wrap">
    <a href="/index.html"><img src="/images/logo.svg"></a>
  </header>

  <main id="contents" class="mypage">
    <div class="mypage_info">
      <section class="profile_area">
        <div class="user_img"></div>
        <div class="user_name"><a href="/mypage_update.html" title="나의 프로필로 이동" class="user_name__link"><span id="username"></span></a></div>
      </section>
  
      <section class="list_area">
          <h3 class="list_title">내가 쓴 글</h3>
          <ul class="list_box"></ul>
      </section>
    </div>
    
    <a href="javascript:;" title="로그아웃" onClick="logout()" class="oneul-btn">로그아웃</a>
  
  </main>
    
  <footer class="footer-wrap">
    <div class="navigator">
      <a href="/index.html" class="nav-item home"><span class="nav-txt">홈</span></a>
      <a href="/search.html" class="nav-item search"><span class="nav-txt">검색</span></a>
      <a href="/list.html" class="nav-item community"><span class="nav-txt">커뮤니티</span></a>
      <a href="/mypage.html" class="nav-item my-page active"><span class="nav-txt">MY</span></a>
    </div>
  </footer>


  <script>
    const db = firebase.firestore();
    const storage = firebase.storage();
    const postRef = db.collection('post');

    firebase.auth().onAuthStateChanged((user)=>{
      if (!user) {
        location.href='/login.html';
      } else if(user) {
        uid = user.uid;
        uname = user.displayName;
        uNicname = user.nickname;
        uPic = user.photoURL;
        uImg = !uPic ? '<p>'+uname.substring(0,1)+'</p>' : '<img src="'+uPic+'" alt="img">';

        $('#username').text(uname)
        $('.user_img').html(uImg)

        //내가쓴게시글
        let query = postRef.where("uid", "==", uid).get().then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              $('.list_box').append('<li class="list_item"><a href="/view.html?id='+doc.id+'" title="'+doc.data().제목+' 보기"><p class="list_subject">'+doc.data().제목+'</p><span class="list_date">'+doc.data().날짜.toDate().toLocaleDateString()+'</span></a></li>');
            });
        })
      }
    })

    function logout() {
      firebase.auth().signOut().then(function(){
        localStorage.removeItem('user');
        location.href='/index.html';
      }).catch(function(error){

      });
    }
    
  </script>
  
</body>
</html>