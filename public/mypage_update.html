<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>오늘뭐볼까? - 마이페이지</title>
  <link rel="icon" href="./images/logo_favicon.png" type="image/x-icon">
  <meta property="og:title" content="오늘뭐볼까?"> 
  <meta property="og:url" content="https://oneul-9b3e4.web.app/">
  <meta property="og:type" content="website">
  <meta property="og:image" content="/images/ogimg.png"> 
  <meta property="og:description" content="영화리뷰 플랫폼 오늘뭐볼까?">
  <link href="css/mypage.css" rel="stylesheet">
  <!-- 필수 호출 script -->
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    const firebaseConfig = {
    apiKey: "AIzaSyBPwBvkUab2QHIgqTPODBIC8gWWowDohjM",
    authDomain: "oneul-9b3e4.firebaseapp.com",
    databaseURL: "https://oneul-9b3e4-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "oneul-9b3e4",
    storageBucket: "oneul-9b3e4.appspot.com",
    messagingSenderId: "993417131341",
    appId: "1:993417131341:web:ce271d5bffa75a7d42f304"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
  </script>
  <!-- 필수 호출 script -->

</head>
<body>
  <header class="header-wrap">
    <a href="/index.html"><img src="/images/logo.svg"></a>
  </header>

  <main id="contents" class="mypage">
    <div class="mypage_info">
        <div class="profile_update_area">
            <div class="user_info">
                <p class="user_info_text"><span class="user_name"></span>님의 회원정보수정</p>
            </div>
            
            <form id="form">
              <!-- <div class="user_img">
                <img src="" alt="">
              </div>
              <div class="file_box">
                <label for="input_file">파일선택</label>
                <input type="file" name="input_file" id="input_file">
              </div> -->
              <input type="email" placeholder="이메일" id="email-new" class="oneul-form" readonly>
              <input type="password" placeholder="패스워드(6자 이상 입력)" id="pw-new" class="oneul-form" required>  
              <input type="text" placeholder="이름" id="name-new" class="oneul-form" required>
            </form> 
          </div>
          
        </div>
        
        <div class="btn_area">
          <!-- <a href="/mypage_delete.html" class="btn_line">탈퇴하기 ></a> -->
          <button type="submit" class="oneul-btn" id="updateProfile">수정하기</button> 
    </div>
  
  </main>
    
  <footer class="footer-wrap">
    <div class="navigator">
      <a href="/index.html" class="nav-item home"><span class="nav-txt">홈</span></a>
      <a href="/search.html" class="nav-item search"><span class="nav-txt">검색</span></a>
      <a href="/list.html" class="nav-item community"><span class="nav-txt">커뮤니티</span></a>
      <a href="/mypage.html" class="nav-item my-page active"><span class="nav-txt">MY</span></a>
    </div>
  </footer>


  <script>
    const user = firebase.auth().currentUser;

    firebase.auth().onAuthStateChanged((user)=>{
        if(user) {
            uname = user.displayName;
            uemail = user.email;
            $('.user_name').text(uname);
            $('#email-new').val(uemail);
        }
    });
    
    $('#updateProfile').click(function(e){
      const form = document.querySelector("#form");
      let state = form.checkValidity();
      if(!!state) {
        e.preventDefault();
        var userPassword = $('#pw-new').val();
        var userName = $('#name-new').val();
        firebase.auth().currentUser.updateProfile({
          displayName: userName,
          userPassword: userPassword
        }).then(() => {
          location.href = "/mypage.html"
        }).catch((error) => {
        }); 
      }
    })
    
  </script>
  
</body>
</html>