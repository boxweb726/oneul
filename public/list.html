<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>오늘뭐볼까? - 커뮤니티</title>
  <link href="./css/style.css" rel="stylesheet">
  <link href="./css/common.css" rel="stylesheet">
  <link rel="icon" href="./images/logo_favicon.png" type="image/x-icon">
</head>
<body>
  <main id="contents">
    <header class="header-wrap">
      <a href="/"><img src="/images/logo.svg"></a>
      <a href="javascript:;" onClick="postUpload()" class="upload-btn btn">글쓰기</a>
    </header>
    <section class="content">
      <a href="javascript:;" class="ad-ban" onClick="alert('광고문의 : 인피니티(단가비쌈)')">
        <img src="./images/ban.svg" style="width:100%;">
      </a>
      <a href="javascript:;" class="ad-waring" onClick="alert('Oneul Premium을 구독해보세요! (기능준비중)')">광고를 보고싶지 않으신가요?</a>
      <ul class="post-list"></ul>
    </section>
    <footer class="footer-wrap">
      <div class="navigator">
        <a href="/index.html" class="nav-item home"><span class="nav-txt">홈</span></a>
        <a href="/search.html" class="nav-item search"><span class="nav-txt">검색</span></a>
        <a href="/list.html" class="nav-item community active"><span class="nav-txt">커뮤니티</span></a>
        <a href="/mypage.html" class="nav-item my-page"><span class="nav-txt">MY</span></a>
    </div>
    </footer>
  </main>

ㅎ
  <!-- 필수 호출 script -->
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    const firebaseConfig = {
    apiKey: "AIzaSyBPwBvkUab2QHIgqTPODBIC8gWWowDohjM",
    authDomain: "oneul-9b3e4.firebaseapp.com",
    databaseURL: "https://oneul-9b3e4-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "oneul-9b3e4",
    storageBucket: "oneul-9b3e4.appspot.com",
    messagingSenderId: "993417131341",
    appId: "1:993417131341:web:ce271d5bffa75a7d42f304"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
  </script>
  <!-- 필수 호출 script -->

  <script>
    const db = firebase.firestore();
 
    // 파이어베이스 DB에 접근, POST라는 컬렉션에서 날짜내림차순 정렬하여 출력
    db.collection('post').orderBy('날짜','desc').get().then((result)=>{
        result.forEach((doc)=>{
            const postList = `<li class="post-list-item">
                                <article class="post-wrap">
                                    <a href="/view.html?id=${doc.id}" class="post-link"> 
                                      <div class="post-item-top">
                                        <p class="post-user">${doc.data().이름}</p>                
                                        <p class="post-date">${doc.data().날짜.toDate().toLocaleString()}</p>
                                      </div>                    
                                      <h2 class="post-title">${doc.data().제목}</h2>
                                      <p class="post-content">${doc.data().내용}</p>
                                      <img src="${doc.data().이미지}" onerror="this.style.display='none'">
                                    </a>
                                </article>
                              </li>`;
            $('.post-list').append(postList);
        })
    })

    // 비회원 글쓰기 제한 함수, 유저정보가 존재할 경우 업로드 페이지 이동, 아닐경우 로그인 페이지 이동
    function postUpload() {
      firebase.auth().onAuthStateChanged((user)=>{
        if (user) {
          window.location.href = "/upload.html";
        } else {
          alert('로그인 후 이용해주세요!!');
          window.location.href = "/login.html";
        }
      })
    }


  </script>
  
</body>
</html>